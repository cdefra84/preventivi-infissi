<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serramento {{ numero }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #FFFFFF;
            margin: 0;
        }

        header img {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .preview-image {
            display: block;
            margin: 20px auto;
            border-radius: 5px;
          }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            padding: 12px;
            font-size: 16px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2563eb;
        }

        footer {
            margin-top: 50px;
            text-align: center;
            padding: 20px;
        }

        footer img {
            width: 100%;
            max-width: 1000px;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        @media (min-width: 600px) {
            .buttons {
                flex-direction: row;
                justify-content: space-between;
            }

            .preview-image {
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
<div class="container">
<header style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
    <!-- Logo -->
    <div>
        <img src="{{ url_for('static', filename='immagini/logo.jpg') }}" alt="Logo Azienda" style="height: 50%;">
    </div>

    <!-- Testo a destra del logo -->
    <div style="font-size: 18px; font-weight: bold; line-height: 1.6; text-align: left;">
        INFISSI MOBILIFICIO E FALEGNAMERIA<br>
        <span style="font-weight: normal;">SHOWROOM ROCCHETTA SANT'ANTONIO<br>Cell. 333.4352383</span><br>
        <span style="font-weight: normal;">SHOWROOM MONTEFALCIONE (AV)<br>Cell. 389.9686594</span> 
    </div>
</header>
    <div style="margin-top: 10px;text-align: center">
        <a href="{{ url_for('index') }}" style="text-decoration: none; color: #3b82f6; font-weight: bold;">üè† Torna alla Home</a>
    </div>




    {# üîÅ Mostra il riepilogo solo se ci sono articoli inseriti #}
    {% if articoli %}
        <h3>Riepilogo serramenti gi√† inseriti</h3>
        <ul style="list-style: none; padding-left: 0;">
            {% for a in articoli %}
                <li style="margin-bottom: 10px; background: #f8f8f8; padding: 10px; border-radius: 5px;">
                    <strong>{{ a.descrizione }}</strong> ‚Äì {{ a.larghezza }}x{{ a.altezza }} mm ‚Äì {{ a.quantita }} pezzi
                    <a href="{{ url_for('articolo', n=loop.index, session=session_id, modifica=1) }}"
                       style="margin-left: 10px; text-decoration: none; color: #007bff;">‚úèÔ∏è Modifica</a>
                </li>
            {% endfor %}
        </ul>
        <br>
    {% endif %}

    {# ‚úÖ FORM SEMPRE VISIBILE #}
    <h2>Inserisci il serramento numero {{ numero }}</h2>
    <form method="POST">

        <label for="descrizione">Descrizione</label>
        <input type="text" name="descrizione" id="descrizione" class="form-control"
               placeholder="Es. Finestra bagno"
               value="{{ (articolo.descrizione if articolo.descrizione is defined else '') | e }}">

        <label>Larghezza (mm)</label>
        <input name="larghezza" type="number" step="1" required
               value="{{ (articolo.larghezza if articolo.larghezza is defined else '') | e }}">

        <label>Altezza (mm)</label>
        <input name="altezza" type="number" step="1" required
               value="{{ (articolo.altezza if articolo.altezza is defined else '') | e }}">

        <label>Spessore infisso (da 76 a 96 mm)</label>
        <input name="spessore" type="number" min="76" max="96" required
               value="{{ (articolo.spessore if articolo.spessore is defined else 76) | e }}">

        <label>Tipo di vetro</label>
        <select name="tipo_vetro">
            <option value="doppio" {% if articolo.tipo_vetro == 'doppio' %}selected{% endif %}>Vetro camera base</option>
            <option value="triplo" {% if articolo.tipo_vetro == 'triplo' %}selected{% endif %}>Triplo vetro</option>
            <option value="argon" {% if articolo.tipo_vetro == 'argon' %}selected{% endif %}>Triplo vetro con Gas Argon</option>
        </select>

        <label>Tipo di serramento</label>
        <select name="tipo_serramento" required>
            <option value="PVC" {% if articolo.tipo_serramento == 'PVC' %}selected{% endif %}>PVC</option>
            <option value="Legno" {% if articolo.tipo_serramento == 'Legno' %}selected{% endif %}>Legno</option>
            <option value="Alluminio" {% if articolo.tipo_serramento == 'Alluminio' %}selected{% endif %}>Alluminio a taglio termico</option>
            <option value="Legno-Alluminio" {% if articolo.tipo_serramento == 'Legno-Alluminio' %}selected{% endif %}>Legno + Alluminio</option>
        </select>

        <label>Numero di ante</label>
        <select name="numero_ante" id="numero_ante" required>
            <option value="1" {% if articolo.numero_ante == '1' %}selected{% endif %}>1 anta</option>
            <option value="2" {% if articolo.numero_ante == '2' %}selected{% endif %}>2 ante</option>
            <option value="3" {% if articolo.numero_ante == '3' %}selected{% endif %}>3 ante</option>
        </select>

        <label>Pellicolato?</label>
        <select name="pellicolato" id="pellicolato">
            <option value="n" {% if articolo.pellicolato == 'n' %}selected{% endif %}>No</option>
            <option value="s" {% if articolo.pellicolato == 's' %}selected{% endif %}>S√¨</option>
        </select>

        <label for="effetto_pellicolato">Effetto pellicolatura (se presente)</label>
        <input name="effetto_pellicolato" id="effetto_pellicolato" class="form-control"
               value="{{ (articolo.effetto_pellicolato if articolo.effetto_pellicolato is defined else '') | e }}"
               placeholder="Es. RAL 7016 esterno, Bianco massa interno">

        <a href="#" onclick="window.open('{{ url_for('static', filename='immagini/pellicole_colori.jpg') }}', 'pellicole', 'width=800,height=600'); return false;">
            üé® Vedi la tabella colori pellicole
        </a>

        <img id="immagine_infisso" class="preview-image" src="{{ url_for('static', filename='immagini/finestra_doppia_bianca.jpg') }}" alt="Ante selezionate">

        <label>Cassonetti tapparelle?</label>
        <select name="cassonetti">
            <option value="n" {% if articolo.cassonetti == 'n' %}selected{% endif %}>No</option>
            <option value="s" {% if articolo.cassonetti == 's' %}selected{% endif %}>S√¨</option>
        </select>

        <label>Avvolgibili? (Oscuranti)</label>
        <select name="avvolgibili">
            <option value="n" {% if articolo.avvolgibili == 'n' %}selected{% endif %}>No</option>
            <option value="s" {% if articolo.avvolgibili == 's' %}selected{% endif %}>S√¨</option>
        </select>

        <label>Rullo Puleggia? (Cintino)</label>
        <select name="rullo">
            <option value="n" {% if articolo.rullo == 'n' %}selected{% endif %}>No</option>
            <option value="s" {% if articolo.rullo == 's' %}selected{% endif %}>S√¨</option>
        </select>

        <label>Vasistas (Ribaltabile)?</label>
        <select name="vasistas">
            <option value="n" {% if articolo.vasistas == 'n' %}selected{% endif %}>No</option>
            <option value="s" {% if articolo.vasistas == 's' %}selected{% endif %}>S√¨</option>
        </select>

        <label for="accessori">Accessori (inserisci il tipo maniglia e il colore)</label>
        <input name="accessori" id="accessori" class="form-control"
               value="{{ (articolo.accessori if articolo.accessori is defined else '') | e }}"
               placeholder="Es. Maniglia base titanio, Maniglia PRO satinata">

        <p>
            <a href="#" onclick="window.open('{{ url_for('static', filename='immagini/Maniglie_colori.jpg') }}', 'maniglie_pro', 'width=800,height=600,scrollbars=yes'); return false;">
                Vedi i tipi di maniglia PRO
            </a><br>
            <a href="#" onclick="window.open('{{ url_for('static', filename='immagini/Maniglie_colori1.jpeg') }}', 'colori_maniglie', 'width=800,height=600,scrollbars=yes'); return false;">
                Vedi i colori delle maniglie
            </a>
        </p>

        <label>Quantit√†</label>
        <input name="quantita" type="number" min="1" required
               value="{{ (articolo.quantita if articolo.quantita is defined else 1) | e }}">

        <input type="hidden" name="totale_articoli" value="{{ totale }}">

        <div class="buttons">
            <button type="submit" name="azione" value="continua">‚ûï Aggiungi un altro serramento</button>
            <button type="submit" name="azione" value="fine">‚úÖ Vai al preventivo</button>
        </div>
    </form>

</div>


<footer>
        <a href="{{ url_for('static', filename='immagini/struttura.jpg') }}" target="_blank">
            <img src="{{ url_for('static', filename='immagini/struttura.jpg') }}" alt="Guarda la struttura">
        </a>
        <p style="font-size: 0.9em; color: #555; margin-top: 10px;">
            Clicca sull'immagine per ingrandire la struttura del serramento
        </p>
    </footer>
<script>
    const img = document.getElementById("immagine_infisso");
    const ante = document.getElementById("numero_ante");
    const effetto = document.getElementById("effetto_pellicolato");
    const larghezzaInput = document.querySelector("input[name='larghezza']");
    const altezzaInput = document.querySelector("input[name='altezza']");

    function aggiornaImmagine() {
        const n = ante.value;
        const effettoTesto = effetto.value.toLowerCase();

        // Determina la categoria in base al colore inserito
        let categoria = "bianca";
        if (
            effettoTesto.includes("golden oak") ||
            effettoTesto.includes("noce") ||
            effettoTesto.includes("douglasie") ||
            effettoTesto.includes("oak") ||
            effettoTesto.includes("af") ||
            effettoTesto.includes("ac") ||
            effettoTesto.includes("shogun") ||
            effettoTesto.includes("mooreiche") ||
            effettoTesto.includes("eiche") ||
            effettoTesto.includes("bergkiefer") ||
            effettoTesto.includes("mahagoni") ||
            effettoTesto.includes("rosso") ||
            effettoTesto.includes("braun")
        ) {
            categoria = "legno";
        } else if (
            effettoTesto.includes("ral 7016") ||
            effettoTesto.includes("ral 9005") ||
            effettoTesto.includes("scuro") ||
            effettoTesto.includes("grigio scuro") ||
            effettoTesto.includes("black") ||
            effettoTesto.includes("antracite") ||
            effettoTesto.includes("earl") ||
            effettoTesto.includes("quarz") ||
            effettoTesto.includes("crown") ||
            effettoTesto.includes("metbrush") ||
            effettoTesto.includes("db703")
        ) {
            categoria = "scuro";
        }

        // Costruisce il nome del file in modo compatto
        let nome = `finestra_${n === "1" ? "singola" : n === "2" ? "doppia" : "tripla"}_${categoria}.jpg`;
        img.src = "/static/immagini/" + nome;

        // Modifica dimensioni immagine in base alle proporzioni
        const larghezza = parseFloat(larghezzaInput.value);
        const altezza = parseFloat(altezzaInput.value);

        if (!isNaN(larghezza) && !isNaN(altezza)) {
            const rapporto = altezza / larghezza;

            if (rapporto > 1.5) {
                img.style.width = "120px";
                img.style.height = "300px";
            } else if (rapporto < 0.75) {
                img.style.width = "300px";
                img.style.height = "120px";
            } else {
                img.style.width = "250px";
                img.style.height = "250px";
            }
        }
    }

    // Event listeners
    ante.addEventListener("change", aggiornaImmagine);
    effetto.addEventListener("input", aggiornaImmagine);
    larghezzaInput.addEventListener("input", aggiornaImmagine);
    altezzaInput.addEventListener("input", aggiornaImmagine);
</script>
<script>
    const pellicolatoSelect = document.getElementById("pellicolato");
    const effettoInput = document.getElementById("effetto_pellicolato");

    function aggiornaObbligatorietaPellicolato() {
        if (pellicolatoSelect.value === "s") {
            effettoInput.setAttribute("required", "required");
        } else {
            effettoInput.removeAttribute("required");
        }
    }

    pellicolatoSelect.addEventListener("change", aggiornaObbligatorietaPellicolato);

    // Esegui subito al caricamento della pagina
    aggiornaObbligatorietaPellicolato();
</script>
</body>
</html>